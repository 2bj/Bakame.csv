<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=Edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Parsing a CSV - Bakame.Csv</title>
<link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Exo+2:400,500,700,700italic,500italic,400italic|Noticia+Text:400,400italic,700,700italic">
<link rel="stylesheet" href="assets/normalize.css">
<link rel="stylesheet" href="assets/prism.css">
<link rel="stylesheet" href="assets/screen.css">
</head>
<body>
<header role="banner">
	<h1>Bakame.csv</h1>
	<p class="tagline">Csv data manipulation made easy in PHP</p>
</header>
<main>
	<menu>
		<h2>Getting Started</h2>
		<ul>
			<li><a href="index.html">Introduction</a></li>
			<li><a href="examples.html">Examples</a></li>
			<li><a href="installation.html">Installation</a></li>
		</ul>
		<h2>The API</h2>
		<ul>
            <li><a href="loading.html">Loading a CSV</a></li>
            <li><a href="conversion.html">Outputting a CSV</a></li>
			<li class="reading.html"><a href="reading.html">Reading a CSV</a></li>
			<li><a href="writing.html">Writing a CSV</a></li>
		</ul>
	</menu>
	<article>
<h1>Parsing a CSV document</h1>

<h2>Extracting data from the CSV</h2>

<p>To extract data use <code>Bakame\Csv\Reader</code> methods.</p>

<h3>fetchAll($callable = null)</h3>
<p><code>fetchAll</code> returns a sequential array of all rows.</p>
<pre><code class="language-php">$data = $reader-&gt;fetchAll();
// will return something like this :
// 
// [ 
//   ['john', 'doe', 'john.doe@example.com'],
//   ['jane', 'doe', 'jane.doe@example.com'],
//   ...
// ]
//
</code></pre>

<h3>fetchAssoc([], $callable = null)</h3>
<p><code>fetchAssoc</code> returns a sequential array of all rows. The rows themselves are associative arrays where the keys are given directly to the method using an one dimension array. This array should only contain unique <code>string</code> and/or <code>integer</code> values.</p>
<pre><code class="language-php">$data = $reader-&gt;fetchAssoc(['firstname', 'lastname', 'email']);
// will return something like this :
// 
// [ 
//   ['firstname' =&gt; 'john', 'lastname' =&gt; 'doe', 'email' =&gt; 'john.doe@example.com'],
//   ['firstname' =&gt; 'jane', 'lastname' =&gt; 'doe', 'email' =&gt; 'jane.doe@example.com'],
//   ...
// ]
// 
</code></pre>

<blockquote>
<ul>
<li>If the number of values in a CSV row is lesser than the number of named keys, the method will add <code>null</code> values to compensate for the missing values.</li>
<li>If the number of values in a CSV row is greater that the number of named keys the exceeding values will be drop from the result set.</li>
</ul>
</blockquote>

<h3>fetchCol($columnIndex = 0, $callable = null)</h3>
<p><code>fetchCol</code> returns a sequential array of all values in a given column from the CSV data.</p>
<ul>
<li>If no argument is given to the method it will return the first colum from the CSV data.</li>
<li>If the column does not exists in the csv data the method will return an array full of null value.</li>
</ul>
<pre><code class="language-php">$data = $reader-&gt;fetchCol(2);
// will return something like this :
// 
// ['john.doe@example.com', 'jane.doe@example.com', ...]
// 
</code></pre>

<p>The methods listed above (<code>fetchAll</code>, <code>fetchAssoc</code>, <code>fetchCol</code>) can all take a optional <code>callable</code> argument to further manipulate each row before being returned. This callable function can take up to three parameters:</p>
<ul>
<li>the current csv row data</li>
<li>the current csv key</li>
<li>the current csv Iterator Object</li>
</ul>
<h3>fetchOne($offset = 0)</h3>
<p><code>fetchOne</code> return one single row from the CSV data. The required argument <code>$offset</code> represent the row index starting at 0. If no argument is given to the method it will return the first row from the CSV data.</p>
<pre><code class="language-php">$data = $reader-&gt;fetchOne(3); ///accessing the 4th row (indexing starts at 0)
// will return something like this :
// 
//   ['john', 'doe', 'john.doe@example.com']
//
</code></pre>

<h2>Filtering the data</h2>

<p>You can further manipulate the CSV <code>fetch*</code> methods output by specifying filtering options using the following methods:</p>
<h3>setFilter($callable = null)</h3>
<p><code>setFilter</code> method specifies an optional <code>callable</code> function to filter the CSV data. This function takes three parameters at most (see <a href="http://php.net/manual/en/class.callbackfilteriterator.php#callbackfilteriterator.examples">CallbackFilterIterator</a> for more informations)</p>
<h3>setSortBy($callable = null)</h3>
<p><code>setSortBy</code> method specifies an optional <code>callable</code> function to sort the CSV data. The function takes two parameters which will be filled by pairs of rows.</p>
<p><strong>Beware when using this filter that you will be using <code>iterator_to_array</code> which could lead to performance penalty if you have a heavy CSV file to sort</strong></p>
<h3>setOffset($offset) and setLimit($limit)</h3>
<ul>
<li><code>setOffset</code> method specifies an optional offset for the return results.</li>
<li><code>setLimit</code> method specifies an optional maximum rows count for the return results. </li>
</ul>
<p><strong>Both methods have no effect on the <code>fetchOne</code> method output</strong></p>
<p>Here's an example:</p>
<pre><code class="language-php">function filterByEmail($row) 
{
    return filer_var($row[2], FILTER_VALIDATE_EMAIL);
}

function sortByLastName($rowA, $rowB)
{
    return strcmp($rowB[1], $rowA[1]);
}

$data = $reader
    -&gt;setOffset(3)
    -&gt;setLimit(2)
    -&gt;setFilter('filterByEmail')
    -&gt;setSortBy('sortByLastName')
    -&gt;fetchAssoc(['firstname', 'lastname', 'email'], function ($value) {
    return array_map('strtoupper', $value);
});
// data length will be equals or lesser that 2 starting from the row index 3.
// will return something like this :
// 
// [ 
//   ['firstname' =&gt; 'JANE', 'lastname' =&gt; 'RAMANOV', 'email' =&gt; 'JANE.RAMANOV@EXAMPLE.COM'],
//   ['firstname' =&gt; 'JOHN', 'lastname' =&gt; 'DOE', 'email' =&gt; 'JOHN.DOE@EXAMPLE.COM'],
// ]
// 
</code></pre>

<p><strong>Of note:</strong></p>
<ul>
<li>The filtering methods are chainable;</li>
<li>The methods can be call in any sort of order before any <code>fetch*</code> method call;</li>
<li>After a <code>fetch*</code> method call, all filtering options are cleared;</li>
<li>Only the last filtering settings are taken into account if the same method is called more than once;</li>
</ul>
<h3>Manual extracting and filtering</h3>
<p>If you want to output differently you data you can use the <code>query</code> method. It works like the <code>fetchAll</code> method but returns an <a href="http://php.net/manual/en/class.iterator.php">Iterator</a> that you may manipulate as you wish.</p>
<pre><code class="language-php">function filterByEmail($row) 
{
    return filer_var($row[2], FILTER_VALIDATE_EMAIL);
}

function sortByLastName($rowA, $rowB)
{
    return strcmp($rowB[1], $rowA[1]);
}

$iterator = $reader
    -&gt;setFilter('filterByEmail')
    -&gt;setSortBy('sortByLastName')
    -&gt;setOffset(3)
    -&gt;setLimit(2)
    -&gt;query(function ($value) {
        return array_map('strtoupper', $value);
    });
</code></pre>
	</article>
</main>
<footer role="contentinfo">
<div>
<p>Bakame.csv is a library coded by <a href="https://github.com/nyamsprod">Nyamagana Butera Ignace</a>.You can contact me using:</p>
<ul>
<li><a href="https://twitter.com/intent/user?screen_name=nyamsprod" target="_blank" title="Follow @nyamsprod on twitter">Twitter</a>
<li><a href="https://www.facebook.com/nyamsprod" target="_blank" title="Join me on facebook">Facebook</a>
<li><a href="http://be.linkedin.com/pub/ignace-philippe-nyamagana-butera/13/a16/6b4" title="Connect with me through LinkedIn">LinkedIn</a>
<li><a href="https://plus.google.com/103435977218171777746/?rel=author" target="_blank" title="Find Nyamsprod on Google+" rel="author">Google+</a>
</ul>
<p class="copyrights">
&copy; Nyamagana Butera Ignace. Site design by  <a href="https://www.nyamsprod.com">Nyamagana Butera Ignace</a><br>
crafted with <strong>Love</strong>, <strong>Passion</strong> and
<a target="_blank" rel="external" href="http://www.vim.org/">Vim</a>.<br>
The site is always rendered using <a target="_blank" rel="external" href="http://www.w3.org/">Open Web Technologies</a>
</p>
</div>
</footer><!-- End Footer -->
<script src="assets/prism.js"></script>
<script>
var _gaq=[["_setAccount","UA-1200654-1"],["_trackPageview"]], ___gcfg = {lang: 'en'};
(function(d, t){
    var g = d.createElement(t),o = d.getElementsByTagName(t)[0];
        g.src = ('https' == d.location.protocol) ? 'https://ssl.google-analytics.com/ga.js' : 'http://www.google-analytics.com/ga.js';
        g.async = 1;
        o.parentNode.insertBefore(g, o);
})(document, 'script');
</script>
</body>
</html>
{"name":"Bakame.csv","tagline":"Csv data manipulation made easy in PHP 5.4+","body":"Bakame.csv\r\n==========\r\n[![Build Status](https://travis-ci.org/nyamsprod/Bakame.csv.png?branch=master)](https://travis-ci.org/nyamsprod/Bakame.csv)\r\n[![Code Coverage](https://scrutinizer-ci.com/g/nyamsprod/Bakame.csv/badges/coverage.png?s=7ad9740c0ed5fd5d389abfe92d7af04d7f4f542e)](https://scrutinizer-ci.com/g/nyamsprod/Bakame.csv/)\r\n\r\nA simple library to easily load, manipulate and save CSV files in PHP 5.4+\r\n\r\nThis package is compliant with [PSR-1][], [PSR-2][], and [PSR-4][].\r\n\r\n[PSR-1]: https://github.com/php-fig/fig-standards/blob/master/accepted/PSR-1-basic-coding-standard.md\r\n[PSR-2]: https://github.com/php-fig/fig-standards/blob/master/accepted/PSR-2-coding-style-guide.md\r\n[PSR-4]: https://github.com/php-fig/fig-standards/blob/master/accepted/PSR-4-autoloader.md\r\n\r\n\r\nSystem Requirements\r\n-------\r\n\r\nYou need **PHP >= 5.4.0** and the `mbstring` extension to use `Bakame\\Csv` but the latest stable version of PHP is recommended.\r\n\r\nInstall\r\n-------\r\n\r\nInstall the Bakame.csv package with Composer.\r\n\r\n```json\r\n{\r\n    \"require\": {\r\n        \"bakame/csv\": \"4.*\"\r\n    }\r\n}\r\n```\r\n\r\nUsage\r\n-------\r\n\r\n* [Selecting specific rows in the CSV](examples/extract.php)\r\n* [Filtering a CSV](examples/filtering.php)\r\n* [Creating a CSV](examples/writing.php)\r\n* [Merging 2 CSV documents](examples/merge.php)\r\n* [Switching between modes from Writer to Reader mode](examples/switchmode.php)\r\n* [Downloading the CSV](examples/download.php)\r\n* [Converting the CSV into a Json String](examples/json.php)\r\n* [Converting the CSV into a XML file](examples/xml.php)\r\n* [Converting the CSV into a HTML Table](examples/table.php)\r\n\r\n> The CSV data use for the examples are taken from [Paris Opendata](http://opendata.paris.fr/opendata/jsp/site/Portal.jsp?document_id=60&portlet_id=121)\r\n\r\n### Tips\r\n\r\n* When creating a file using the library, first insert all the data that need to be inserted before starting manipulating the CSV. If you manipulate your data before insertion, you may change the file cursor position and get unexpected results.\r\n\r\n* If you are dealing with non-unicode data, specify the encoding parameter using the `setEncoding` method otherwise your output conversions may no work.\r\n\r\n* When merging multiples CSV documents don't forget to set the main CSV object\r\n as a `Bakame\\Csv\\Writer` object with the `$open_mode = 'a+'` to preserve its content.\r\n This setting is of course not required when your main `Bakame\\Csv\\Writer` object is \r\n created from String\r\n\r\n* **If you are on a Mac OS X Server**, add the following lines before using the library to help [PHP detect line ending in Mac OS X](http://php.net/manual/en/function.fgetcsv.php#refsect1-function.fgetcsv-returnvalues).\r\n\r\n```php\r\nif (! ini_get(\"auto_detect_line_endings\")) {\r\n    ini_set(\"auto_detect_line_endings\", true);\r\n}\r\n```\r\n\r\nDocumentation\r\n-------\r\n\r\nThe library is composed of two main classes:\r\n* `Bakame\\Csv\\Reader` to extract and filter data from a CSV\r\n* `Bakame\\Csv\\Writer` to insert new data into a CSV.\r\n\r\nBoth classes share methods to instantiate, format and output the CSV.\r\n\r\n### Instantiation\r\n\r\nThere's several ways to instantiate these classes:\r\n\r\n```php\r\nuse Bakame\\Csv\\Reader;\r\nuse Bakame\\Csv\\Writer;\r\n\r\n$reader = new Reader('/path/to/your/csv/file.csv');\r\n$reader = new Reader(new SpliFileInfo('/path/to/your/csv/file.csv'));\r\n$reader = Reader::createFromString('john,doe,john.doe@example.com');\r\n\r\n//or \r\n\r\n$writer = new Writer('/path/to/your/csv/file.csv', 'w');\r\n$writer = new Writer(new SpliFileObject('/path/to/your/csv/file.csv'), 'a+');\r\n$writer = Writer::createFromString('john,doe,john.doe@example.com');\r\n```\r\n\r\nBoth classes constructors take one optional parameter `$open_mode` representing the file open mode used by the PHP [fopen](http://php.net/manual/en/function.fopen.php) function. \r\n* The `Bakame\\Csv\\Writer` `$open_mode` default value is `w`.\r\n* The `Bakame\\Csv\\Reader` `$open_mode` default value is `r`, and **no other value is possible**. So you don't need to explicitly set it.\r\n\r\nThe static method `createFromString` is to be use if your data is a string. This method takes no optional `$open_mode` parameter.\r\n\r\nOnce your object is created you can optionally set:\r\n\r\n* the CSV delimiter, enclosure and/or escape characters;\r\n* the object `SplFileObject` flags;\r\n* the CSV encoding charset if the CSV is not in `UTF-8`;\r\n\r\n```php\r\n$reader = new Reader('/path/to/your/csv/file.csv');\r\n\r\n$reader->setDelimeter(',');\r\n$reader->setEnclosure('\"');\r\n$reader->setEscape('\\\\');\r\n$reader->setFlags(SplFileObject::READ_AHEAD|SplFileObject::SKIP_EMPTY);\r\n$reader->setEncoding('iso-8859-1');\r\n```\r\n\r\n### Traversing the CSV\r\n\r\nWith both classes you can iterate over your csv data using the `foreach` construct:\r\n\r\n```php\r\nforeach ($reader as $row) {\r\n    //do something meaningfull here with $row !!\r\n    //$row is an array where each item represent a CSV data cell\r\n}\r\n```\r\n\r\n### Outputting the CSV\r\n\r\n**Don't forget to set the CSV encoding format before using any outputting CSV method if your data is not `UTF-8` encoded.**\r\n\r\nWith both classes you can:\r\n\r\n#### show the CSV content:\r\n\r\nUse the `echo` construct on the instantiated object or use the `__toString` method.\r\n\r\n```php\r\necho $writer;\r\n//or\r\necho $writer->__toString();\r\n```\r\n\r\n#### convert to XML:\r\n\r\nUse the `toXML` method to convert the CSV data into a PHP `DomDocument` object. This method accepts 3 optionals arguments `$root_name`, `$row_name`, `$cell_name` to help you customize the XML tree. \r\n\r\nBy default:\r\n* `$root_name = 'csv'` \r\n* `$row_name = 'row'` \r\n* `$cell_name = 'cell'` \r\n\r\n```php\r\n$dom = $writer->toXML('data', 'item', 'cell');\r\n```\r\n\r\n#### convert to HTML table:\r\n\r\nUse the `toHTML` method to format the CSV data into an HTML table. This method accepts an optional argument `$classname` to help you customize the table rendering, by defaut the classname given to the table is `table-csv-data`.\r\n\r\n```php\r\necho $writer->toHTML('table table-bordered table-hover');\r\n```\r\n\r\n#### convert to Json\r\n\r\nUse the `json_encode` function directly on the instantiated object.\r\n\r\n```php\r\necho json_encode($writer);\r\n```\r\n\r\n**Of Note:** When using the `toHTML`, `toXML` methods and the `json_encode` function, the data is internally convert if needed into `UTF-8`.\r\n\r\n#### download the CSV\r\n\r\nIf you only wish to make your CSV downloadable just use the `output` method to return to the output buffer the CSV content.\r\n\r\n```php\r\n$reader->setEncoding('ISO-8859-15');\r\nheader('Content-Type: text/csv; charset=\"'.$reader->getEncoding().'\"');\r\nheader('Content-Disposition: attachment; filename=\"name-for-your-file.csv\"');\r\n$reader->output();\r\n```\r\nThe output method can take an optional argument `$filename`. When present you can even omit most of the headers.\r\n\r\n```php\r\n$reader->setEncoding('ISO-8859-15');\r\n$reader->output(\"name-for-your-file.csv\");\r\n```\r\n\r\nExtracting data from the CSV\r\n-------\r\n\r\nTo extract data use `Bakame\\Csv\\Reader` methods.\r\n\r\n#### fetchAll($callable = null)\r\n\r\n `fetchAll` returns a sequential array of all rows.\r\n\r\n```php\r\n$data = $reader->fetchAll();\r\n// will return something like this :\r\n// \r\n// [ \r\n//   ['john', 'doe', 'john.doe@example.com'],\r\n//   ['jane', 'doe', 'jane.doe@example.com'],\r\n//   ...\r\n// ]\r\n//\r\n```\r\n#### fetchAssoc([], $callable = null)\r\n\r\n`fetchAssoc` returns a sequential array of all rows. The rows themselves are associative arrays where the keys are given directly to the method using an one dimension array. This array should only contain unique `string` and/or `integer` values.\r\n\r\n```php\r\n$data = $reader->fetchAssoc(['firstname', 'lastname', 'email']);\r\n// will return something like this :\r\n// \r\n// [ \r\n//   ['firstname' => 'john', 'lastname' => 'doe', 'email' => 'john.doe@example.com'],\r\n//   ['firstname' => 'jane', 'lastname' => 'doe', 'email' => 'jane.doe@example.com'],\r\n//   ...\r\n// ]\r\n// \r\n```\r\n\r\n> * If the number of values in a CSV row is lesser than the number of named keys, the method will add `null` values to compensate for the missing values.\r\n> * If the number of values in a CSV row is greater that the number of named keys the exceeding values will be drop from the result set.\r\n\r\n#### fetchCol($columnIndex = 0, $callable = null)\r\n\r\n`fetchCol` returns a sequential array of all values in a given column from the CSV data.\r\n\r\n* If no argument is given to the method it will return the first colum from the CSV data.\r\n* If the column does not exists in the csv data the method will return an array full of null value.\r\n\r\n```php\r\n$data = $reader->fetchCol(2);\r\n// will return something like this :\r\n// \r\n// ['john.doe@example.com', 'jane.doe@example.com', ...]\r\n// \r\n\r\n```\r\n\r\nThe methods listed above (`fetchAll`, `fetchAssoc`, `fetchCol`) can all take a optional `callable` argument to further manipulate each row before being returned. This callable function can take up to three parameters:\r\n\r\n* the current csv row data\r\n* the current csv key\r\n* the current csv Iterator Object\r\n\r\n#### fetchOne($offset = 0)\r\n\r\n`fetchOne` return one single row from the CSV data. The required argument `$offset` represent the row index starting at 0. If no argument is given to the method it will return the first row from the CSV data.\r\n\r\n```php\r\n$data = $reader->fetchOne(3); ///accessing the 4th row (indexing starts at 0)\r\n// will return something like this :\r\n// \r\n//   ['john', 'doe', 'john.doe@example.com']\r\n//\r\n```\r\n\r\n### Filtering the data\r\n\r\nYou can further manipulate the CSV `fetch*` methods output by specifying filtering options using the following methods:\r\n\r\n#### setFilter($callable = null)\r\n\r\n`setFilter` method specifies an optional `callable` function to filter the CSV data. This function takes three parameters at most (see [CallbackFilterIterator][] for more informations)\r\n\r\n[CallbackFilterIterator]: http://php.net/manual/en/class.callbackfilteriterator.php#callbackfilteriterator.examples\r\n\r\n#### setSortBy($callable = null)\r\n\r\n`setSortBy` method specifies an optional `callable` function to sort the CSV data. The function takes two parameters which will be filled by pairs of rows.\r\n\r\n**Beware when using this filter that you will be using `iterator_to_array` which could lead to performance penalty if you have a heavy CSV file to sort**\r\n\r\n#### setOffset($offset) and setLimit($limit)\r\n\r\n* `setOffset` method specifies an optional offset for the return results.\r\n* `setLimit` method specifies an optional maximum rows count for the return results. \r\n\r\n**Both methods have no effect on the `fetchOne` method output**\r\n\r\nHere's an example:\r\n\r\n```php\r\nfunction filterByEmail($row) \r\n{\r\n    return filer_var($row[2], FILTER_VALIDATE_EMAIL);\r\n}\r\n\r\nfunction sortByLastName($rowA, $rowB)\r\n{\r\n    return strcmp($rowB[1], $rowA[1]);\r\n}\r\n\r\n$data = $reader\r\n    ->setOffset(3)\r\n    ->setLimit(2)\r\n    ->setFilter('filterByEmail')\r\n    ->setSortBy('sortByLastName')\r\n    ->fetchAssoc(['firstname', 'lastname', 'email'], function ($value) {\r\n    return array_map('strtoupper', $value);\r\n});\r\n// data length will be equals or lesser that 2 starting from the row index 3.\r\n// will return something like this :\r\n// \r\n// [ \r\n//   ['firstname' => 'JANE', 'lastname' => 'RAMANOV', 'email' => 'JANE.RAMANOV@EXAMPLE.COM'],\r\n//   ['firstname' => 'JOHN', 'lastname' => 'DOE', 'email' => 'JOHN.DOE@EXAMPLE.COM'],\r\n// ]\r\n// \r\n```\r\n**Of note:**\r\n\r\n* The filtering methods are chainable;\r\n* The methods can be call in any sort of order before any `fetch*` method call;\r\n* After a `fetch*` method call, all filtering options are cleared;\r\n* Only the last filtering settings are taken into account if the same method is called more than once;\r\n\r\n### Manual extracting and filtering\r\n\r\nIf you want to output differently you data you can use the `query` method. It works like the `fetchAll` method but returns an [Iterator][] that you may manipulate as you wish.\r\n\r\n[Iterator]: http://php.net/manual/en/class.iterator.php\r\n\r\n```php\r\nfunction filterByEmail($row) \r\n{\r\n    return filer_var($row[2], FILTER_VALIDATE_EMAIL);\r\n}\r\n\r\nfunction sortByLastName($rowA, $rowB)\r\n{\r\n    return strcmp($rowB[1], $rowA[1]);\r\n}\r\n\r\n$iterator = $reader\r\n    ->setFilter('filterByEmail')\r\n    ->setSortBy('sortByLastName')\r\n    ->setOffset(3)\r\n    ->setLimit(2)\r\n    ->query(function ($value) {\r\n        return array_map('strtoupper', $value);\r\n    });\r\n```\r\n\r\nInserting data into the CSV\r\n-------\r\n\r\nTo create or update a CSV use the following specific `Bakame\\Csv\\Writer` methods.\r\n\r\n#### insertOne\r\n\r\n`insertOne` inserts a single row. This method can take an `array`, a `string` or an `object` implementing the `__toString` method.\r\n\r\n```php\r\nclass ToStringEnabledClass\r\n{\r\n    private $str;\r\n\r\n    public function __construct($str)\r\n    {\r\n        $this->str = $str;\r\n    }\r\n\r\n    public function __toString()\r\n    {\r\n        return $this->str;\r\n    }\r\n}\r\n\r\n$writer->insertOne(['john', 'doe', 'john.doe@example.com']); //used with an array\r\n$writer->insertOne(\"'john','doe','john.doe@example.com'\");   //used with a string\r\n$writer->insertOne(new ToStringEnabledClass(\"john,doe,john.doe@example.com\")) //used with an object implementing the '__toString' magic method;\r\n\r\n```\r\n\r\n#### insertAll\r\n\r\n`insertAll` inserts multiple rows. This method can take an `array` or a `Traversable` object to add several rows to the CSV data.\r\n\r\n\r\n```php\r\n$arr = [\r\n    [1, 2, 3],\r\n    ['foo', 'bar', 'baz'],\r\n    \"'john','doe','john.doe@example.com'\",\r\n    new ToStringEnabledClass(\"john,doe,john.doe@example.com\")\r\n];\r\n\r\n$writer->insertAll($arr) //using an array \r\n\r\n$object = new ArrayIterator($arr);\r\n$writer->insertAll($object); //using a Traversable object\r\n```\r\n\r\n**When inserting strings don't forget to specify the CSV delimiter and enclosure characters that match those use in the string**.\r\n\r\n\r\nSwitching from one class to the other\r\n-------\r\n\r\nIt is possible to switch between modes by using:\r\n\r\n* the `Bakame\\Csv\\Writer::getReader` method from the `Bakame\\Csv\\Writer` class\r\n* the `Bakame\\Csv\\Reader::getWriter` method from the `Bakame\\Csv\\Reader` class this method accept the optional `$open_mode` parameter.\r\n\r\n```php\r\n$reader = $writer->getReader();\r\n$newWriter = $reader->getWriter('a'); \r\n```\r\n**be careful the `$newWriter` object is not equal to the `$writer` object!!**\r\n\r\nTesting\r\n-------\r\n\r\n``` bash\r\n$ phpunit\r\n```\r\n\r\nContributing\r\n-------\r\n\r\nPlease see [CONTRIBUTING](CONTRIBUTING.md) for details.\r\n\r\nCredits\r\n-------\r\n\r\n- [ignace nyamagana butera](https://github.com/nyamsprod)\r\n- [All Contributors](graphs/contributors)\r\n\r\n[![Bitdeli Badge](https://d2weczhvl823v0.cloudfront.net/nyamsprod/bakame.csv/trend.png)](https://bitdeli.com/free \"Bitdeli Badge\")","google":"UA-1200654-1","note":"Don't delete this file! It's used internally to help with page regeneration."}